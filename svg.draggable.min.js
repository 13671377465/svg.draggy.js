// svg.draggable.js 0.7 - Copyright (c) 2013 Wout Fierens - Licensed under the MIT license
SVG.extend(SVG.Element,{draggable:function(e){var t,n,r,i=this,s=this._parent(SVG.Nested)||this._parent(SVG.Doc);e=e||{};t=function(e){var t,o=s.attr("viewBox"),u=s.attr("width");if(i.beforedrag)i.beforedrag(e);if(i instanceof SVG.G)t={x:i.transform("x"),y:i.transform("y")};else t=i.bbox();i.startEvent=e||window.event;i.startPosition={x:t.x,y:t.y,width:t.width,height:t.height,zoom:1};if(o!=null&&u!=null)i.startPosition.zoom=parseFloat(u)/parseFloat(o.split(" ")[2]);SVG.on(window,"mousemove",n);SVG.on(window,"mouseup",r);if(i.dragstart)i.dragstart({x:0,y:0,zoom:i.startPosition.zoom},e)};n=function(t){if(i.startEvent){var n,r,s=i.startPosition.width,o=i.startPosition.height,u={x:t.pageX-i.startEvent.pageX,y:t.pageY-i.startEvent.pageY,zoom:i.startPosition.zoom};n=i.startPosition.x+u.x/i.startPosition.zoom;r=i.startPosition.y+u.y/i.startPosition.zoom;if(e.minX!=null&&n<e.minX)n=e.minX;else if(e.maxX!=null&&n>e.maxX-s)n=e.maxX-s;if(e.minY!=null&&r<e.minY)r=e.minY;else if(e.maxY!=null&&r>e.maxY-o)r=e.maxY-o;i.move(n,r);if(i.dragmove)i.dragmove(u,t)}};r=function(e){var t={x:e.pageX-i.startEvent.pageX,y:e.pageY-i.startEvent.pageY,zoom:i.startPosition.zoom};i.startEvent=null;i.startPosition=null;SVG.off(window,"mousemove",n);SVG.off(window,"mouseup",r);if(i.dragend)i.dragend(t,e)};i.on("mousedown",t);i.fixed=function(){i.off("mousedown",t);SVG.off(window,"mousemove",n);SVG.off(window,"mouseup",r);t=n=r=null;return i};return this}});