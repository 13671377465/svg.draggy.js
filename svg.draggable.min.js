(function(){SVG.extend(SVG.Element,{draggable:function(a){var b,c,d,e=this;return"function"==typeof this.fixed&&this.fixed(),a=a||{},b=function(a){var b=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc);a=a||window.event,e.beforedrag&&e.beforedrag(a);var f=e.bbox();e instanceof SVG.G?(f.x=e.x(),f.y=e.y()):e instanceof SVG.Nested&&(f={x:e.x(),y:e.y(),width:e.width(),height:e.height()}),e.startEvent=a,e.startPosition={x:f.x,y:f.y,width:f.width,height:f.height,zoom:b.viewbox().zoom,rotation:e.transform("rotation")*Math.PI/180},SVG.on(window,"mousemove",c),SVG.on(window,"mouseup",d),e.dragstart&&e.dragstart({x:0,y:0,zoom:e.startPosition.zoom},a),a.preventDefault?a.preventDefault():a.returnValue=!1},c=function(b){if(b=b||window.event,e.startEvent){var c,d,f=e.startPosition.rotation,g=e.startPosition.width,h=e.startPosition.height,i={x:b.pageX-e.startEvent.pageX,y:b.pageY-e.startEvent.pageY,zoom:e.startPosition.zoom};if(c=e.startPosition.x+(i.x*Math.cos(f)+i.y*Math.sin(f))/e.startPosition.zoom,d=e.startPosition.y+(i.y*Math.cos(f)+i.x*Math.sin(-f))/e.startPosition.zoom,"function"==typeof a){var j=a(c,d);"object"==typeof j?"boolean"!=typeof j.x||j.x?e.x("number"==typeof j.x?j.x:c):("boolean"!=typeof j.y||j.y)&&e.y("number"==typeof j.y?j.y:d):"boolean"==typeof j&&j&&e.move(c,d)}else"object"==typeof a&&(null!==a.minX&&c<a.minX?c=a.minX:null!==a.maxX&&c>a.maxX-g&&(c=a.maxX-g),null!==a.minY&&d<a.minY?d=a.minY:null!==a.maxY&&d>a.maxY-h&&(d=a.maxY-h),e.move(c,d));e.dragmove&&e.dragmove(i,b)}},d=function(a){a=a||window.event;var b={x:a.pageX-e.startEvent.pageX,y:a.pageY-e.startEvent.pageY,zoom:e.startPosition.zoom};e.startEvent=null,e.startPosition=null,SVG.off(window,"mousemove",c),SVG.off(window,"mouseup",d),e.dragend&&e.dragend(b,a)},e.on("mousedown",b),e.fixed=function(){return e.off("mousedown",b),SVG.off(window,"mousemove",c),SVG.off(window,"mouseup",d),b=c=d=null,e},this}})}).call(this);