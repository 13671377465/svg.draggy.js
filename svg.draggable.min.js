(function(){SVG.extend(SVG.Element,{draggable:function(constraint){var start,drag,end,element=this;if(typeof this.fixed==="function"){this.fixed()}constraint=constraint||{};start=function(event){var parent=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc);event=event||window.event;if(element.beforedrag){element.beforedrag(event)}var box=element.bbox();if(element instanceof SVG.G){box.x=element.x();box.y=element.y()}else if(element instanceof SVG.Nested){box={x:element.x(),y:element.y(),width:element.width(),height:element.height()}}element.startEvent=event;element.startPosition={x:box.x,y:box.y,width:box.width,height:box.height,zoom:parent.viewbox().zoom,rotation:element.transform("rotation")*Math.PI/180};SVG.on(window,"mousemove",drag);SVG.on(window,"mouseup",end);element.node.dispatchEvent(new CustomEvent("dragstart",event));if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}};function elmZoom(elm){if(!elm||typeof elm.transform!=="function"){return{x:1,y:1}}var p=elm.parent;var t=elm.transform();pz={};var pz=elmZoom(p);return{x:t.scaleX*pz.x,y:t.scaleY*pz.y}}drag=function(event){event=event||window.event;if(element.startEvent){var x,y,rotation=element.startPosition.rotation,width=element.startPosition.width,height=element.startPosition.height,delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom};var zoom=elmZoom(element);x=element.startPosition.x+(delta.x*Math.cos(rotation)+delta.y*Math.sin(rotation))/Math.pow(zoom.x,2);y=element.startPosition.y+(delta.y*Math.cos(rotation)+delta.x*Math.sin(-rotation))/Math.pow(zoom.y,2);if(typeof constraint==="function"){var coord=constraint(x,y);if(typeof coord==="object"){if(typeof coord.x!=="boolean"||coord.x){element.x(typeof coord.x==="number"?coord.x:x)}else if(typeof coord.y!=="boolean"||coord.y){element.y(typeof coord.y==="number"?coord.y:y)}}else if(typeof coord==="boolean"&&coord){element.move(x,y)}}else if(typeof constraint==="object"){if(constraint.minX!==null&&x<constraint.minX){x=constraint.minX}else if(constraint.maxX!==null&&x>constraint.maxX-width){x=constraint.maxX-width}if(constraint.minY!==null&&y<constraint.minY){y=constraint.minY}else if(constraint.maxY!==null&&y>constraint.maxY-height){y=constraint.maxY-height}element.move(x,y)}element.node.dispatchEvent(new CustomEvent("dragmove",delta,event))}};end=function(event){event=event||window.event;var delta={x:event.pageX-element.startEvent.pageX,y:event.pageY-element.startEvent.pageY,zoom:element.startPosition.zoom};element.startEvent=null;element.startPosition=null;SVG.off(window,"mousemove",drag);SVG.off(window,"mouseup",end);element.node.dispatchEvent(new CustomEvent("dragend",{x:0,y:0},event))};element.on("mousedown",start);element.fixed=function(){element.off("mousedown",start);SVG.off(window,"mousemove",drag);SVG.off(window,"mouseup",end);start=drag=end=null;return element};return this}})}).call(this);